=== Design Notes

== Usage Overview

annodir [action] [extra options]

action is one of --list (default), --add, --delete, --edit

== Storage

Data is stored in $PWD/.annodir, which is a plain text file. This should be
overridable via commandline and maybe an environment variable. The file contains
a number of entries. Each entry has a header identifying the class of the entry
(todo item, note etc) followed by a series of key=value lines (we'll need to
escape these somehow), followed by an end marker to make parsing nice and easy.
For example: >

	note:
	  created_by=ciaranm
	  created_at=1097533644
	  title=Some Random Example
	  body=Fnord
	end
	todo:
	  created_by=ciaranm
	  created_at=1097533688
	  text=Figure out how to escape newlines etc here
	  priority=medium
	end

For compatability, we should be able to handle any kind of item (without any
special context stuff) with a generic fallback. We then have special handlers
for notes, todo items and so on. Common fields such as created_by (multi user is
good, once we figure out locking) can be handled automagically by the base entry
class maybe?

Maybe a --title option for setting a title for a certain annodir file.  Could 
possibly inherit from database_entry_T and use the following format at the top
of the file: >

    title:
	title=The Title of this Directory Annotation
    end

< [ Personally I'd prefer metadata:, we can add in other stuff later too if we
think of anything. -- ciaranm ]

== Internal Workings

We've got a number of key components:

-- commandline

Figures out what action to call (add, list, delete etc) and calls the relevant
handler

Uses getopt_long, which is available on all Linux systems and all of the modern
BSD's.  We shouldn't have any problems, however we must keep in mind that there
are very small differences between GNU and BSD getopt_long implementations, so 
there is a chance for very subtle command-line option bugs.  These differences
are documented in BSD's getopt_long(3) manual page.  A fallback to getopt()
should still be implemented, since any POSIX.2-compliant OS should support it.

-- action handlers

Different handlers for different actions. We have a list handler, an add handler
and so on.  Also, an action for creating TODO files (nicely formatted with
dates, time, user, etc), --export=todo possibly...  Maybe a link action for
linking in annodir files from other directories, or could that be handled as
just another type of regular entry? Like, --add --type=link blah/.annodir or
something...

-- extra input

Presumably we'll want to get some input not via the commandline. Use readline
maybe? Dunno.

-- backend

We've got a db class and then a class structure for the different entry kinds.
The entries themselves can save and load via a stream and also display
themselves nicely (we need a nice display module for this, right now nicely
means print 'em out). The db itself can save (calls each item to do that) and
load (parses the header, creates the relevant class).

 vim: set tw=80 :
